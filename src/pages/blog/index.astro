---
import Layout from '../../layouts/BaseLayout.astro'   // keep this path if your layout name/path match
import FormattedDate from '../../components/FormattedDate.astro'
import { getCollection } from 'astro:content'

const posts = (await getCollection('blog'))
  .sort((a,b) => +new Date(b.data.pubDate) - +new Date(a.data.pubDate))

// bullet-proof slug (works even if Astro didn’t set .slug)
const toSlug = (p) => p.slug ?? p.id.replace(/\.(md|mdx)$/, '')
---

<Layout title="Blog — Smart Call Decline" description="All posts from the Smart Call Decline blog.">
  <main class="container prose mx-auto">
    <h1>Blog</h1>
    <ul>
      {posts.map((post) => (
        <li>
          <a href={`/blog/${toSlug(post)}/`}>
            <h3>{post.data.title}</h3>
            <p class="date"><FormattedDate date={post.data.pubDate} /></p>
          </a>
        </li>
      ))}
    </ul>
  </main>
</Layout>
